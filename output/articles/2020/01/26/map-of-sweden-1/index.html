<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Map of Sweden #1 - Wolfblog</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">




<style type="text/css">

/*some stuff for output/input prompts*/
div.cell{border:1px solid transparent;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}div.cell.selected{border-radius:4px;border:thin #ababab solid}
div.cell.edit_mode{border-radius:4px;border:thin #008000 solid}
div.cell{width:100%;padding:5px 5px 5px 0;margin:0;outline:none}
div.prompt{min-width:11ex;padding:.4em;margin:0;font-family:monospace;text-align:right;line-height:1.21429em}
@media (max-width:480px){div.prompt{text-align:left}}div.inner_cell{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1}
div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;line-height:1.21429em}
div.prompt:empty{padding-top:0;padding-bottom:0}
div.input{page-break-inside:avoid;display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:horizontal;-moz-box-align:stretch;display:box;box-orient:horizontal;box-align:stretch;}
div.inner_cell{width:90%;}
div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;}
div.input_prompt{color:navy;border-top:1px solid transparent;}
div.output_wrapper{margin-top:5px;position:relative;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
div.output_scroll{height:24em;width:100%;overflow:auto;border-radius:4px;-webkit-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);-moz-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);}
div.output_collapsed{margin:0px;padding:0px;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
div.out_prompt_overlay{height:100%;padding:0px 0.4em;position:absolute;border-radius:4px;}
div.out_prompt_overlay:hover{-webkit-box-shadow:inset 0 0 1px #000000;-moz-box-shadow:inset 0 0 1px #000000;box-shadow:inset 0 0 1px #000000;background:rgba(240, 240, 240, 0.5);}
div.output_prompt{color:darkred;}

a.anchor-link:link{text-decoration:none;padding:0px 20px;visibility:hidden;}
h1:hover .anchor-link,h2:hover .anchor-link,h3:hover .anchor-link,h4:hover .anchor-link,h5:hover .anchor-link,h6:hover .anchor-link{visibility:visible;}
/* end stuff for output/input prompts*/


.highlight-ipynb .hll { background-color: #ffffcc }
.highlight-ipynb  { background: #f8f8f8; }
.highlight-ipynb .c { color: #408080; font-style: italic } /* Comment */
.highlight-ipynb .err { border: 1px solid #FF0000 } /* Error */
.highlight-ipynb .k { color: #008000; font-weight: bold } /* Keyword */
.highlight-ipynb .o { color: #666666 } /* Operator */
.highlight-ipynb .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight-ipynb .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight-ipynb .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight-ipynb .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight-ipynb .gd { color: #A00000 } /* Generic.Deleted */
.highlight-ipynb .ge { font-style: italic } /* Generic.Emph */
.highlight-ipynb .gr { color: #FF0000 } /* Generic.Error */
.highlight-ipynb .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight-ipynb .gi { color: #00A000 } /* Generic.Inserted */
.highlight-ipynb .go { color: #888888 } /* Generic.Output */
.highlight-ipynb .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight-ipynb .gs { font-weight: bold } /* Generic.Strong */
.highlight-ipynb .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight-ipynb .gt { color: #0044DD } /* Generic.Traceback */
.highlight-ipynb .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight-ipynb .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight-ipynb .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight-ipynb .kp { color: #008000 } /* Keyword.Pseudo */
.highlight-ipynb .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight-ipynb .kt { color: #B00040 } /* Keyword.Type */
.highlight-ipynb .m { color: #666666 } /* Literal.Number */
.highlight-ipynb .s { color: #BA2121 } /* Literal.String */
.highlight-ipynb .na { color: #7D9029 } /* Name.Attribute */
.highlight-ipynb .nb { color: #008000 } /* Name.Builtin */
.highlight-ipynb .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight-ipynb .no { color: #880000 } /* Name.Constant */
.highlight-ipynb .nd { color: #AA22FF } /* Name.Decorator */
.highlight-ipynb .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight-ipynb .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight-ipynb .nf { color: #0000FF } /* Name.Function */
.highlight-ipynb .nl { color: #A0A000 } /* Name.Label */
.highlight-ipynb .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight-ipynb .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight-ipynb .nv { color: #19177C } /* Name.Variable */
.highlight-ipynb .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight-ipynb .w { color: #bbbbbb } /* Text.Whitespace */
.highlight-ipynb .mf { color: #666666 } /* Literal.Number.Float */
.highlight-ipynb .mh { color: #666666 } /* Literal.Number.Hex */
.highlight-ipynb .mi { color: #666666 } /* Literal.Number.Integer */
.highlight-ipynb .mo { color: #666666 } /* Literal.Number.Oct */
.highlight-ipynb .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight-ipynb .sc { color: #BA2121 } /* Literal.String.Char */
.highlight-ipynb .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight-ipynb .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight-ipynb .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight-ipynb .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight-ipynb .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight-ipynb .sx { color: #008000 } /* Literal.String.Other */
.highlight-ipynb .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight-ipynb .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight-ipynb .ss { color: #19177C } /* Literal.String.Symbol */
.highlight-ipynb .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight-ipynb .vc { color: #19177C } /* Name.Variable.Class */
.highlight-ipynb .vg { color: #19177C } /* Name.Variable.Global */
.highlight-ipynb .vi { color: #19177C } /* Name.Variable.Instance */
.highlight-ipynb .il { color: #666666 } /* Literal.Number.Integer.Long */
</style>

<style type="text/css">
/* Overrides of notebook CSS for static HTML export */
div.entry-content {
  overflow: visible;
  padding: 8px;
}
.input_area {
  padding: 0.2em;
}

a.heading-anchor {
 white-space: normal;
}

.rendered_html
code {
 font-size: .8em;
}

pre.ipynb {
  color: black;
  background: #f7f7f7;
  border: none;
  box-shadow: none;
  margin-bottom: 0;
  padding: 0;
  margin: 0px;
  font-size: 13px;
}

/* remove the prompt div from text cells */
div.text_cell .prompt {
    display: none;
}

/* remove horizontal padding from text cells, */
/* so it aligns with outer body text */
div.text_cell_render {
    padding: 0.5em 0em;
}

img.anim_icon{padding:0; border:0; vertical-align:middle; -webkit-box-shadow:none; -box-shadow:none}

div.collapseheader {
    width=100%;
    padding: 2px;
    cursor: pointer;
    font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;
}

</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
<script type="text/javascript">
init_mathjax = function() {
    if (window.MathJax) {
        // MathJax loaded
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
            },
            displayAlign: 'left', // Change this to 'center' to center equations.
            "HTML-CSS": {
                styles: {'.MathJax_Display': {"margin": 0}}
            }
        });
        MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
    }
}
init_mathjax();
</script>

<link rel="canonical" href="/articles/2020/01/26/map-of-sweden-1/">

        <meta name="author" content="Mats Melander" />
        <meta name="keywords" content="D3,Maps" />
        <meta name="description" content="A note on making maps #1" />

        <meta property="og:site_name" content="Wolfblog" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Map of Sweden #1"/>
        <meta property="og:url" content="/articles/2020/01/26/map-of-sweden-1/"/>
        <meta property="og:description" content="A note on making maps #1"/>
        <meta property="article:published_time" content="2020-01-26" />
            <meta property="article:section" content="Technologies" />
            <meta property="article:tag" content="D3" />
            <meta property="article:tag" content="Maps" />
            <meta property="article:author" content="Mats Melander" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="/components/font-awesome/css/font-awesome.min.css" rel="stylesheet">

<!--    <link href="/theme/css/font-awesome.min.css" rel="stylesheet"> -->

    <link href="/theme/css/pygments/default.css" rel="stylesheet">
    <link rel="stylesheet" href="/theme/css/style.css" type="text/css"/>




</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="/" class="navbar-brand">
<img class="img-responsive pull-left gap-right" src="/img/Wolf_logo.png" width="30"/> Wolfblog            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/archives.html">Archive</a></li>
                         <li><a href="/pages/about/">
                             About
                          </a></li>
                        <li class="active">
                            <a href="/category/technologies">Technologies</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<!-- Banner -->
<!-- End Banner -->

<!-- Content Container -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="/articles/2020/01/26/map-of-sweden-1/"
                       rel="bookmark"
                       title="Permalink to Map of Sweden #1">
                        Map of Sweden #1
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2020-01-26T00:00:00+01:00"> Sun 26 January 2020</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="/tag/d3">D3</a>
        /
	<a href="/tag/maps">Maps</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>This is a description on how to use <a class="reference external" href="https://d3js.org/">D3</a>, Data Driven Documents, to visualize and manipulate maps
objects.</p>
<p>The end result is visible <a class="reference external" href="https://www.viltstigen.se/clover/index.html">here</a>.
The project is available on Github (<a class="reference external" href="https://github.com/Wolfrax/clover">link</a>).</p>
<div class="section" id="making-a-map-of-sweden">
<h2>Making a map of Sweden</h2>
<p>First, we need to find some data describing the geometry we want. While there are several sources to choose from,
in this case I will be using <a class="reference external" href="https://www.naturalearthdata.com/">Natural Earth</a> that are providing a wealth of
datasets in different scales for free. As I'm interested in Sweden and some of its administrative subunits (countys)
for my project, only a selection of shapefiles is needed. Below I provide links to zip-archives for shapefiles in the
scale of 1:10 million.</p>
<ul class="simple">
<li><a class="reference external" href="https://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-admin-0-details">NE 1:10m admin 0 details</a></li>
<li><a class="reference external" href="https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_admin_1_states_provinces.zip">NE 1:10m admin 1 state provinces</a></li>
<li><a class="reference external" href="https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_populated_places.zip">NE 1:10m populated places</a></li>
</ul>
<p>For the first zip-archive link, according to Natural Earth it includes:</p>
<blockquote>
Countries subdivided by non-contiguous units. Mainland metropolitan France separate from the island of Corsica.
These rarely correspond to actual administrative divisions but rather highlight geographical regions that are not
continuous but are part of the same country. (<a class="reference external" href="https://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-admin-0-details/">Link</a>)</blockquote>
<p>For the second zip-archive link, Natural Earth says that we get:</p>
<blockquote>
Internal, first-order administrative boundaries and polygons for all but a few tiny countries. (<a class="reference external" href="https://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-admin-1-states-provinces/">Link</a>)</blockquote>
<p>The third link includes shape files city and town points:</p>
<blockquote>
Point symbols with name attributes. Includes all admin-0 and many admin-1 capitals, major cities and towns,
plus a sampling of smaller towns in sparsely inhabited regions. (<a class="reference external" href="https://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-populated-places/">Link</a>)</blockquote>
<p>We now have shapefiles which includes the geometry we want to use as a subset. How do we go from here?
For the purpose of rendering using D3, we need to filter out the geometries I'm looking for, then transform the
geometries from the original format in a 2-step approach; first transform into <a class="reference external" href="https://en.wikipedia.org/wiki/GeoJSON">GeoJSON</a>
and then into <a class="reference external" href="https://en.wikipedia.org/wiki/GeoJSON#TopoJSON">TopoJSON</a>.
For this we need to use tools, the <a class="reference external" href="https://gdal.org/programs/ogr2ogr.html">ogr2ogr</a> tool and
<a class="reference external" href="https://github.com/topojson/topojson/wiki">topjson</a> respectively.</p>
<p><strong>ogr2ogr</strong> is part of <a class="reference external" href="https://gdal.org/">GDAL</a> and official binaries for download can be found
<a class="reference external" href="http://trac.osgeo.org/gdal/wiki/DownloadingGdalBinaries">here</a>.</p>
<p>For Mac, go this way</p>
<div class="highlight"><pre><span></span>$ brew install gdal
</pre></div>
<p>On a raspberry pi, running raspbian, the following commands should work (I have not tried):</p>
<div class="highlight"><pre><span></span>$ sudo apt-get update
$ sudo apt-get install gdal-bin
</pre></div>
<p><strong>topojson</strong> tool is installed (on Mac at least) by</p>
<div class="highlight"><pre><span></span>$ npm install -g topojson@1
</pre></div>
<p>(Install npm using this command: <tt class="docutils literal">$ brew install node</tt>)</p>
<p>Unzip the shapefiles above, then try</p>
<div class="highlight"><pre><span></span>$ ogr2ogr -f GeoJSON -where <span class="s2">&quot;ADM0_A3 = &#39;SWE&#39;&quot;</span> subunits.json ne_10m_admin_1_states_provinces.shp
</pre></div>
<p>This should produce a new file subunits.json. The input parameters to ogr2ogr is straightforward:</p>
<ul class="simple">
<li><strong>-f</strong> GeoJSON says that the output file format should be GeoJSON, subunits.json is the name of the output file and
ne_10m_admin_1_states_provinces.shp is the input file.</li>
<li><strong>-where</strong> is the filter parameter with a SQL-like syntax, the trick is here to know that we want to filter on the
condition that ADM0_A3 should be equal to SWE. ADM0 refers to Admin-0, the highest level administrative boundaries,
and A3 refers to <a class="reference external" href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3">ISO 3166-1 alpha-3</a> country codes.</li>
</ul>
<p>Now we can convert from GeoJSON to TopeJSON using topojson tool like so</p>
<div class="highlight"><pre><span></span>$ topojson -o swe.json --properties -- subunits.json
</pre></div>
<p>Here we ask topojson to create output file swe.json and use subunits.json as input.
If everything is working correctly, we now have swe.json in topoJSON format that D3 can read and display, shown below.</p>
<div class="section" id="use-d3-to-draw-a-map">
<h3>Use D3 to draw a map</h3>
<p>Let's start using D3, a javascript library to manipulate HTML documents using data.
We need to combine D3 with a simple HTML document, the skeleton for the HTML5 document is</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Map<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;//d3js.org/d3.v3.js&quot;</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;//d3js.org/topojson.v1.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p>Now we need to include some D3 javascript code between the &lt;script&gt; and &lt;/script&gt; tags. Like so,</p>
<div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">width</span> <span class="o">=</span> <span class="mf">1000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">height</span> <span class="o">=</span> <span class="mf">600</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">svg</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;svg&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="nx">width</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="nx">height</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">projection</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">geo</span><span class="p">.</span><span class="nx">mercator</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">center</span><span class="p">([</span><span class="mf">14.6</span><span class="p">,</span> <span class="mf">62.1</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="mf">1000</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">translate</span><span class="p">([</span><span class="nx">width</span> <span class="o">/</span> <span class="mf">2</span><span class="p">,</span> <span class="nx">height</span> <span class="o">/</span> <span class="mf">2</span><span class="p">]);</span>
<span class="kd">let</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">geo</span><span class="p">.</span><span class="nx">path</span><span class="p">().</span><span class="nx">projection</span><span class="p">(</span><span class="nx">projection</span><span class="p">);</span>

<span class="nx">d3</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="s2">&quot;swe.json&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">svg</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;map&quot;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">topojson</span><span class="p">.</span><span class="nx">feature</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">d</span><span class="p">.</span><span class="nx">objects</span><span class="p">.</span><span class="nx">subunits</span><span class="p">).</span><span class="nx">features</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;style&quot;</span><span class="p">,</span> <span class="s2">&quot;fill: grey&quot;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="nx">path</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
<p>And that's it really, if we combine this together into a html file, e.g. swe.hmtl, and bring this up in a browser we
should see a map of Sweden.</p>
<p>What is the javascript code doing?</p>
<p>In the let <tt class="docutils literal">svg = ...</tt>, I use the D3 selection - selecting the &lt;body&gt;-tag in the HTML code and appending an
&lt;svg&gt;-tag with 2 attributes width and height. The projection variable is pointing to the d3 mercator function
(this is a <a class="reference external" href="https://en.wikipedia.org/wiki/Mercator_projection">standard cylindrical map projection</a>).
To this I center the map on the geographical mid point of Sweden (lat 62.1, lon 14.6), scale the image with factor
1000 and translate all coordinates to the mid-values of width and height. Finally, I define the svg-path variable
using the projection.</p>
<p>d3.json() function reads the json-formated file swe.json that we created before. Then we use the selectAll
function to add the tag &lt;map&gt; to svg for all data. The data is generated through the function call to topojson which
will return an array of datapoints to draw.</p>
<p>There is plenty of sites explaining and describing D3, so I am sketchy here.</p>
<p>Result visible here.</p>
<p>We get something like this.</p>
<div class="align-center figure">
<img alt="alternate text" src="/img/sweden_with_places.png" style="width: 270px; height: 541px;" />
<p class="caption">Map of Sweden</p>
</div>
</div>
<div class="section" id="variations-of-the-map">
<h3>Variations of the map</h3>
<p>We can do more, for example include places by doing this</p>
<div class="highlight"><pre><span></span>$ ogr2ogr -f GeoJSON -where <span class="s2">&quot;ISO_A2 = &#39;SE&#39; AND SCALERANK &lt;8&quot;</span> places.json ne_10m_populated_places.shp
$ topojson -o swe.json -- subunits.json places.json
</pre></div>
<p>From the populated_places shape file (ne_10m_populated_places.shp) we have now filtered on Sweden using
<a class="reference external" href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2">ISO 3166-1 alpha-2</a> 2 letter code instead of the previous 3
letter code (the choice of letter codes seems to be somewhat arbitrary...) and the major cities by using SCALERANK
(see <a class="reference external" href="https://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-populated-places/">here</a> on SCALERANKS).
Then we append this javascript code to draw the places:</p>
<div class="highlight"><pre><span></span><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">datum</span><span class="p">(</span><span class="nx">topojson</span><span class="p">.</span><span class="nx">feature</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">d</span><span class="p">.</span><span class="nx">objects</span><span class="p">.</span><span class="nx">places</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="nx">path</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;place&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>

            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Recent Posts -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
  <ul class="list-group" id="recentposts">
    <li class="list-group-item"><a href="/articles/2021/11/08/visualizing-wind-using-leaflet/">Visualizing wind using Leaflet</a></li>
    <li class="list-group-item"><a href="/articles/2021/09/13/flask-application-behind-a-reverse-proxy/">Flask application behind a reverse proxy</a></li>
    <li class="list-group-item"><a href="/articles/2021/07/14/setting-referer-policy-when-using-applause-button/">Setting referer policy when using applause button</a></li>
    <li class="list-group-item"><a href="/articles/2021/05/02/mdns-for-linux/">mDNS for Linux</a></li>
    <li class="list-group-item"><a href="/articles/2020/10/07/rsyslog-daemon-filling-syslog/">rsyslog daemon filling syslog</a></li>
  </ul>
</li>
<!-- End Sidebar/Recent Posts -->

<!-- Sidebar/Github -->
<li class="list-group-item">
  <h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
  <div id="gh_repos">
    <p class="list-group-item">Status updating...</p>
  </div>
</li>
<!-- End Sidebar/Github -->

<!-- Sidebar/Links -->
<li class="list-group-item">
  <h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
  <ul class="list-group" id="links">
    <li class="list-group-item">
      <a href="https://www.viltstigen.se/" target="_blank">Viltstigen</a>
    </li>
    <li class="list-group-item">
      <a href="http://wlog.viltstigen.se/" target="_blank">Wolfblog</a>
    </li>
    <li class="list-group-item">
      <a href="https://github.com/wolfrax" target="_blank">Github</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Links -->

<!-- Sidebar/Archive -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Archive</span></h4>
  <ul class="list-group" id="archive">
        <li class="list-group-item">
          <a href="/archive/2021/Nov/index.html"><i class="fa fa-calendar fa-lg"></i>November 2021 (1)
          </a>
        </li>
        <li class="list-group-item">
          <a href="/archive/2021/Sep/index.html"><i class="fa fa-calendar fa-lg"></i>September 2021 (1)
          </a>
        </li>
        <li class="list-group-item">
          <a href="/archive/2021/Jul/index.html"><i class="fa fa-calendar fa-lg"></i>July 2021 (1)
          </a>
        </li>
        <li class="list-group-item">
          <a href="/archive/2021/May/index.html"><i class="fa fa-calendar fa-lg"></i>May 2021 (1)
          </a>
        </li>
        <li class="list-group-item">
          <a href="/archive/2020/Oct/index.html"><i class="fa fa-calendar fa-lg"></i>October 2020 (2)
          </a>
        </li>
        <li class="list-group-item">
          <a href="/archive/2020/Jul/index.html"><i class="fa fa-calendar fa-lg"></i>July 2020 (2)
          </a>
        </li>
        <li class="list-group-item">
          <a href="/archive/2020/Jun/index.html"><i class="fa fa-calendar fa-lg"></i>June 2020 (1)
          </a>
        </li>
        <li class="list-group-item">
          <a href="/archive/2020/Feb/index.html"><i class="fa fa-calendar fa-lg"></i>February 2020 (6)
          </a>
        </li>
        <li class="list-group-item">
          <a href="/archive/2020/Jan/index.html"><i class="fa fa-calendar fa-lg"></i>January 2020 (11)
          </a>
        </li>
  </ul>
</li>
<!-- End Sidebar/Archive -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<!-- End Content Container -->

<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2021 Mats Melander
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="/theme/js/respond.min.js"></script>



<!-- GitHub JS Code -->
<script type="text/javascript">
$(document).ready(function () {
  if (!window.jXHR) {
    var jxhr = document.createElement('script');
    jxhr.type = 'text/javascript';
    jxhr.src = '/theme/js/jXHR.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(jxhr, s);
  }

  github.showRepos({
    user: 'wolfrax',
    count: 5,
    skip_forks: false,
    target: '#gh_repos'
  });
});
</script>
<script src="/theme/js/github.js" type="text/javascript"></script>
<!-- End GitHub JS Code -->

<script type="text/javascript">
jQuery(document).ready(function($) {
    $("div.collapseheader").click(function () {
    $header = $(this).children("span").first();
    $codearea = $(this).children(".input_area");
    console.log($(this).children());
    $codearea.slideToggle(500, function () {
        $header.text(function () {
            return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
        });
    });
});
});
</script>
</body>
</html>