<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Mats Melander" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="Raspberry, SSH, Technologies, " />

<meta property="og:title" content="SSH "/>
<meta property="og:url" content="https://wlog.viltstigen.se/articles/2020/01/11/ssh/" />
<meta property="og:description" content="Session without password This describes how to connect with SSH To not provide password manually a public/private keys can be generated and stored at appropriate directories in host (private key) and target (public key). To generate keys on my MacBook and then store the public key on the raspberry …" />
<meta property="og:site_name" content="Wolfblog" />
<meta property="og:article:author" content="Mats Melander" />
<meta property="og:article:published_time" content="2020-01-11T00:00:00+01:00" />
<meta property="og:article:modified_time" content="2020-03-02T00:00:00+01:00" />
<meta name="twitter:title" content="SSH ">
<meta name="twitter:description" content="Session without password This describes how to connect with SSH To not provide password manually a public/private keys can be generated and stored at appropriate directories in host (private key) and target (public key). To generate keys on my MacBook and then store the public key on the raspberry …">

        <title>SSH  · Wolfblog
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="https://wlog.viltstigen.se/theme/css/elegant.prod.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://wlog.viltstigen.se/theme/css/custom.css" media="screen">

        <link href="https://wlog.viltstigen.se/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Wolfblog - Full Atom Feed" />
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-97010459-1', 'auto');
    ga('send', 'pageview');
</script>


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://wlog.viltstigen.se/"><span class=site-name>Wolfblog</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://wlog.viltstigen.se
                                    >Home</a>
                                </li>
                                <li ><a href="https://wlog.viltstigen.se/pages/about/">About</a></li>
                                <li ><a href="https://wlog.viltstigen.se/categories.html">Categories</a></li>
                                <li ><a href="https://wlog.viltstigen.se/tags.html">Tags</a></li>
                                <li ><a href="https://wlog.viltstigen.se/archives.html">Archives</a></li>
                                <li><form class="navbar-search" action="https://wlog.viltstigen.se/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://wlog.viltstigen.se/articles/2020/01/11/ssh/">
                SSH
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <div class="section" id="session-without-password">
<h2>Session without password</h2>
<p>This describes how to connect with <a class="reference external" href="https://en.wikipedia.org/wiki/Secure_Shell">SSH</a></p>
<p>To not provide password manually a public/private keys can be generated and stored at appropriate directories in host
(private key) and target (public key).</p>
<p>To generate keys on my MacBook and then store the public key on the raspberry host rpi1 do</p>
<div class="highlight"><pre><span></span>$ ssh-keygen -t rsa -C pi@rpi1
$ cat ~/.ssh/id_rsa.pub <span class="p">|</span> ssh pi@rpi1.local <span class="s1">&#39;cat &gt;&gt; .ssh/authorized_keys&#39;</span>
</pre></div>
<p>Note that the last command transfer the public key to rpi1 using ssh and store it in file <tt class="docutils literal"><span class="pre">~/.ssh/authorized_keys</span></tt>.
This will invoke to provide password for SSH.</p>
<p>Make sure that directory <tt class="docutils literal">.ssh</tt> exists on home directory for user pi at the raspberry host rpi1.
If not do <tt class="docutils literal">$ install <span class="pre">-d</span> <span class="pre">-m</span> 700 <span class="pre">~/.ssh</span></tt> at the rpi1 first</p>
<p>Note, if file <tt class="docutils literal"><span class="pre">~/.ssh/id_rsa.pub</span></tt> already exists at host (Mac) there is no need to do ssh-keygen, simply do the last
command above ($ cat ~/.ssh...).</p>
<p>To remove an entry in <tt class="docutils literal"><span class="pre">~/.ssh/known_hosts</span></tt> do</p>
<div class="highlight"><pre><span></span>$ ssh-keygen -R rpi1.local
</pre></div>
<p>See <a class="reference external" href="https://www.raspberrypi.org/documentation/remote-access/ssh/passwordless.md">SSH passwordless</a>.</p>
<p>If ssh tries to connect to a known IP address but receives a different ssh key from the one it got before,
it makes sense to treat this as a possible security problem and refuse to connect. This can happen if there is a new
installation of Raspbian and most commonly manifests by the ssh client reporting something like:</p>
<div class="highlight"><pre><span></span>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
Someone could be eavesdropping on you right now <span class="o">(</span>man-in-the-middle attack<span class="o">)</span>!
It is also possible that a host key has just been changed.
The fingerprint <span class="k">for</span> the ECDSA key sent by the remote host is
...
</pre></div>
<p>To mitigate this the local ssh client file <tt class="docutils literal">known_hosts</tt> needs to be updated. Do this locally (Mac) assuming the
issues occur while using ssh vs host 192.168.1.50 (rpi1.loca.).</p>
<div class="highlight"><pre><span></span>$ ssh-keyscan <span class="m">192</span>.168.1.50 &gt;&gt; ~/.ssh/known_hosts
</pre></div>
<p>If the IP address or the node name (e.g. &quot;192.168.1.50&quot; or &quot;rpi1.local&quot;) has been used before, an error message might
occur. To find out which entry is for a known hostname in known_hosts:</p>
<div class="highlight"><pre><span></span>$ ssh-keygen -H  -F &lt;hostname or IP address&gt;
</pre></div>
<p>To delete a single entry from known_hosts (remove both IP address and node name as needed:</p>
<blockquote>
$ ssh-keygen -R &lt;hostname or IP address&gt;</blockquote>
<p>Then re-do the command <cite>$ ssh-keyscan 192.168.1.50 &gt;&gt; ~/.ssh/known_hosts</cite>.</p>
</div>
<div class="section" id="github-ssh-access">
<h2>Github ssh access</h2>
<p>On Raspberry Pi do (see <a class="reference external" href="https://help.github.com/articles/generating-ssh-keys/">https://help.github.com/articles/generating-ssh-keys/</a>)</p>
<div class="highlight"><pre><span></span>$ ssh-keygen -t rsa -b <span class="m">4096</span> -C <span class="s2">&quot;mats.melander@gmail.com&quot;</span> <span class="c1"># Generate public/private rsa keys in ~/.ssh directory</span>
$ <span class="nb">eval</span> <span class="s2">&quot;</span><span class="k">$(</span>ssh-agent -s<span class="k">)</span><span class="s2">&quot;</span>                                 <span class="c1"># Make sure ssh is running, should respond &quot;Agent pid 12693&quot;</span>
$ ssh-add ~/.ssh/id_rsa
$ cat .ssh/id_rsa.pub                                    <span class="c1"># List content, copy the content</span>
</pre></div>
<p>Go to github and login, under settings/SSH keys, do &quot;add new key&quot;. Copy content from the public key.</p>
<p>Verify on RPi with</p>
<div class="highlight"><pre><span></span>$ ssh -T git@github.com
Warning: Permanently added the RSA host key <span class="k">for</span> IP address <span class="s1">&#39;192.30.252.128&#39;</span> to the list of known hosts.
Hi Wolfrax! You<span class="err">&#39;</span>ve successfully authenticated, but GitHub does not provide shell access.
</pre></div>
<p>To have github working with ssh rather than https do (see <a class="reference external" href="https://help.github.com/articles/changing-a-remote-s-url/">https://help.github.com/articles/changing-a-remote-s-url/</a>,
below is valid for user Wolfrax and repository &quot;Swind&quot;)</p>
<div class="highlight"><pre><span></span>$ git remote -v
origin<span class="se">\ </span>    https://github.com/Wolfrax/Swind.git <span class="o">(</span>fetch<span class="o">)</span>
origin<span class="se">\ </span>    https://github.com/Wolfrax/Swind.git <span class="o">(</span>push<span class="o">)</span>
$ git remote set-url origin git@github.com:Wolfrax/Swind.git
$ git remote -v
origin<span class="se">\ </span>    git@github.com:Wolfrax/Swind.git <span class="o">(</span>fetch<span class="o">)</span>
origin<span class="se">\ </span>    git@github.com:Wolfrax/Swind.git <span class="o">(</span>push<span class="o">)</span>
</pre></div>
</div>
<div class="section" id="osx">
<h2>OSX</h2>
<p>On Mac OSX, I made the following update to <tt class="docutils literal"><span class="pre">~/.ssh/config</span></tt> (user config file, the system wide file is on
/etc/ssh/ssh_config, or equivalently /private/etc/ssh/ssh_config).</p>
<div class="highlight"><pre><span></span>AddressFamily inet
</pre></div>
<p>This forces ssh to use IPv4 only, default value is &quot;any&quot; which enables both IPv4 and IPv6. I had some trouble with
one Raspberry (rpi2, 192.168.1.51) when using <tt class="docutils literal">$ ssh pi&#64;rpi2.local</tt>. When debugging (using <tt class="docutils literal">$ ssh <span class="pre">-vvv</span> pi&#64;rpi2.local
``) it turned out that ``rpi2.local</tt> were translated into an IPv6 address instead of an IPv4
for unknown reasons. Using an IPv6, ssh command had to timeout then it retried with a correct IPv4 address instead and
connected successfully. This caused and a long connection time.</p>
<p>For my other raspberries, this has not been a problem. I have not digged further into why this became a problem for
<strong>rpi2</strong> only.</p>
</div>



             


<script src="https://wlog.viltstigen.se/theme/applause-button/applause-button.js"></script>
<div class="applause_button">
    <applause-button url=https://wlog.viltstigen.se/articles/2020/01/11/ssh/> </applause-button>
</div>

 
            
            
            






            <hr/>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2020-01-11T00:00:00+01:00">Jan 11, 2020</time>
<h4>Last Updated</h4>
<time datetime="2020-03-02T00:00:00+01:00">Mar 2, 2020</time>

            <h4>Category</h4>
            <a class="category-link" href="https://wlog.viltstigen.se/categories.html#technologies-ref">Technologies</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://wlog.viltstigen.se/tags.html#raspberry-ref">Raspberry
                    <span>6</span>
</a></li>
                <li><a href="https://wlog.viltstigen.se/tags.html#ssh-ref">SSH
                    <span>2</span>
</a></li>
            </ul>
<h4>Contact</h4>
<div id="sidebar-social-link">
    <a href="mailto:mats.melander@gmail.com" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Mail" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#328cff"/><path d="m250 186c-46 0-69 35-69 74 0 44 29 72 68 72 43 0 73-32 73-75 0-44-34-71-72-71zm-1-37c30 0 57 13 77 33 0-22 35-22 35 1v150c-1 10 10 16 16 9 25-25 54-128-14-187-64-56-149-47-195-15-48 33-79 107-49 175 33 76 126 99 182 76 28-12 41 26 12 39-45 19-168 17-225-82-38-68-36-185 67-248 78-46 182-33 244 32 66 69 62 197-2 246-28 23-71 1-71-32v-11c-20 20-47 32-77 32-57 0-108-51-108-108 0-58 51-110 108-110" fill="#fff"/></svg>
    </a>
    <a href="https://github.com/wolfrax" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>